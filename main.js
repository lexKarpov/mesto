(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.d({},{hi:()=>ut,x7:()=>Z,uh:()=>$,iF:()=>U,iK:()=>nt});var n=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._form=n,this._validObj=e,this._button=this._form.querySelector(this._validObj.submitButtonSelector)}var n,r;return n=t,(r=[{key:"enableValidation",value:function(){var t=this;this.checkButtonValidity(),this._inputList=this._form.querySelectorAll(this._validObj.inputSelector),this._inputList.forEach((function(e){return e.addEventListener("input",(function(){t._checkInputValidity(e),t.checkButtonValidity()}))}))}},{key:"checkButtonValidity",value:function(){this._form.checkValidity()?(this._button.removeAttribute("disabled"),this._button.classList.remove(this._validObj.inputErrorClass)):(this._button.setAttribute("disabled",""),this._button.classList.add(this._validObj.inputErrorClass))}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}},{key:"_showInputError",value:function(t,e){var n=this._form.querySelector(".".concat(t.name,"-error"));t.classList.add(this._validObj.errorClass),n.textContent=e}},{key:"blockButton",value:function(){this._button.setAttribute("disabled","")}},{key:"_hideInputError",value:function(t){var e=this._form.querySelector(".".concat(t.name,"-error"));t.classList.remove(this._validObj.errorClass),e.textContent=""}},{key:"clearError",value:function(){var t=this;this._inputList.forEach((function(e){return t._hideInputError(e)}))}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}(),r=(document.querySelector(".card-template").content,document.querySelector(".popup_type_image")),o=(r.querySelector(".popup__image"),r.querySelector(".popup__figcaption"),{formSelector:".isvalid",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__submit_disable",errorClass:"error-color"});function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(e,n,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._objFromServer=o,this._name=e,this._link=n,this._card=document.querySelector(".card-template").content.cloneNode(!0),this._galleryTitle=this._card.querySelector(".gallery__title"),this._galleryImages=this._card.querySelector(".gallery__img"),this._cardDeleteButton=this._card.querySelector(".gallery__delete"),this._like=this._card.querySelector(".gallery__like"),this._elem=this._card.querySelector(".gallery__card"),this._likeCounter=this._card.querySelector(".gallery__like-counter"),this._handleCardClick=r}var e,n;return e=t,(n=[{key:"_likeToggles",value:function(){var t=this;this._like.classList.toggle("gallery__like_active"),this._like.classList.contains("gallery__like_active")?ut.getLikesCoins(this._objectProperty._id).then((function(e){t.countLikes(e)})).catch((function(t){return console.log("error: ".concat(t.message))})):ut.deleteLikesCoins(this._objectProperty._id).then((function(e){t.countLikes(e)}))}},{key:"_getObj",value:function(){return[this._objectProperty,this._elem]}},{key:"deleteCard",value:function(){ut.deleteCard(this._objectProperty._id),this._elem.remove(),this._elem=null}},{key:"_setEventListener",value:function(){var t=this;this._objectProperty.owner._id!==U&&(this._cardDeleteButton.style.display="none"),this._cardDeleteButton.addEventListener("click",(function(e){return nt.open(t._getObj())})),this._like.addEventListener("click",(function(){return t._likeToggles(t._like)})),this._galleryImages.addEventListener("click",(function(){return t._handleCardClick(t._name,t._link)}))}},{key:"countLikes",value:function(t){t.likes.length>0?(this._likeCounter.classList.add("gallery__like-counter_active"),this._likeCounter.textContent=t.likes.length):this._likeCounter.classList.remove("gallery__like-counter_active")}},{key:"createCard",value:function(t){var e=this;return t.likes.some((function(t){t._id===U&&e._like.classList.add("gallery__like_active")})),this._galleryTitle.textContent=this._name,this._galleryTitle.classList.add("ellipsis"),this._galleryImages.src=this._link,this._galleryImages.alt=this._name,this._objectProperty=t,this.countLikes(t),this._setEventListener(),this._elem}}])&&i(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(){function t(e,n){var r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=r,this._container=n}var e,n;return e=t,(n=[{key:"renderItems",value:function(t){var e=this;t.forEach((function(t){e._elem=e._renderer(t)}))}},{key:"addItem",value:function(t){this._container.prepend(t)}}])&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var s=function(){function t(e){var n,r,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(t){("Escape"===t.key||t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__button-close"))&&o.close()},(n="_handleClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._selector=e,this._element=document.querySelector(this._selector)}var e,n;return e=t,(n=[{key:"open",value:function(){this._element.classList.add("popup_opened")}},{key:"close",value:function(){var t=this;this._element.classList.add("animation"),setTimeout((function(){t._element.classList.remove("popup_opened"),t._element.classList.remove("animation")}),300),document.removeEventListener("keydown",this._handleClose)}},{key:"setEventListeners",value:function(){document.addEventListener("keydown",this._handleClose),this._element.addEventListener("click",this._handleClose)}}])&&l(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=y(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},h.apply(this,arguments)}function y(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}function _(t,e){return _=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_(t,e)}function d(t,e){if(e&&("object"===f(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_(t,e)}(c,t);var e,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=v(r);if(o){var n=v(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return d(this,t)});function c(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,t))._submitFunc=e,n._form=n._element.querySelector(".popup__admin"),n._inputList=n._form.querySelectorAll(".popup__input"),n}return e=c,(n=[{key:"open",value:function(){Z.checkButtonValidity(),$.checkButtonValidity(),h(v(c.prototype),"open",this).call(this)}},{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var t=this;this._form.classList.contains("popup__admin_confirm-delete-card")||this._form.addEventListener("submit",(function(e){return t._submitFunc(e,t._getInputValues())})),h(v(c.prototype),"setEventListeners",this).call(this)}},{key:"close",value:function(){this._form.reset(),h(v(c.prototype),"close",this).call(this)}}])&&p(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(s);function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function k(){return k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=j(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},k.apply(this,arguments)}function j(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=P(t)););return t}function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}function O(t,e){if(e&&("object"===m(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function P(t){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},P(t)}var E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(c,t);var e,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=P(r);if(o){var n=P(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return O(this,t)});function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=i.call(this,t))._img=e._element.querySelector(".popup__image"),e._caption=e._element.querySelector(".popup__figcaption"),e}return e=c,(n=[{key:"open",value:function(t){var e=t.name,n=t.link;this._img.src=n,this._img.alt=e,this._caption.textContent=e,k(P(c.prototype),"open",this).call(this)}}])&&g(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(s);function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var S=function(){function t(e){var n=e.name,r=e.activity;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=document.querySelector(n),this._activity=document.querySelector(r)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{name:this._name.textContent,activity:this._activity.textContent}}},{key:"setUserInfo",value:function(t){var e=t.name,n=t.activity;this._name.textContent=e,this._activity.textContent=n}}])&&C(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var T=function(){function t(e,n,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e.baseUrl,this._auth=e.headers.authorization,this._func1=n,this._func2=r,this._func3=o}var e,n;return e=t,(n=[{key:"postCard",value:function(t,e){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:"".concat(this._auth),"Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)}))}},{key:"getInitialCards",value:function(){fetch("".concat(this._url,"/cards"),{headers:{authorization:"".concat(this._auth)}}).then((function(t){return t.json()})).then((function(t){console.log(t)}))}},{key:"patchText",value:function(t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(this._auth),"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.activity})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)}))}},{key:"getUserInfo",value:function(){var t=this;fetch("".concat(this._url,"/users/me"),{headers:{authorization:"".concat(this._auth)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){t._func1(e)})).catch((function(t){return console.log(t)}))}},{key:"renderCards",value:function(){var t=this;fetch("".concat(this._url,"/cards"),{headers:{authorization:"".concat(this._auth)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){t._func2(e)})).catch((function(t){return console.log(t)}))}},{key:"getLikesCoins",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t,"/likes"),{method:"PUT",headers:{authorization:"".concat(this._auth),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)}))}},{key:"deleteLikesCoins",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t,"/likes"),{method:"DELETE",headers:{authorization:"".concat(this._auth),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)}))}},{key:"deleteCard",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(this._auth),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)}))}},{key:"changeAvatar",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/cohort-39/users/me/avatar",{method:"PATCH",headers:{authorization:"".concat(this._auth),"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)}))}}])&&L(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function q(t){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(t)}function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=x(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},I.apply(this,arguments)}function x(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}function B(t,e){return B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},B(t,e)}function V(t,e){if(e&&("object"===q(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}var z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}(c,t);var e,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=D(r);if(o){var n=D(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return V(this,t)});function c(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,t))._submitFunc=e,n}return e=c,(n=[{key:"open",value:function(t){this._cardObj=t,I(D(c.prototype),"open",this).call(this)}},{key:"setEventListeners",value:function(){var t=this;I(D(c.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(e){return t._submitFunc(e,t._cardObj)}))}},{key:"close",value:function(){I(D(c.prototype),"close",this).call(this)}}])&&R(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(b),U="",A=document.querySelector(".profile__avatar"),F=document.querySelector(".profile__redactor-image"),N=document.querySelector(".profile__redaction-button"),J=document.querySelector(".popup__admin_type_text"),H=document.querySelector(".popup__admin_type_image"),K=document.querySelector(".popup__admin_type_image-profile"),M=document.querySelector(".popup__input_field_name"),G=document.querySelector(".popup__input_field_activity"),Q=document.querySelector(".cards"),W=document.querySelector(".profile__button"),X=function(t,e,n){var r=new c(t,e,(function(t,e){rt.open({name:t,link:e})}),Q);return r.createCard(n)},Y=new n(o,J),Z=new n(o,H),$=new n(o,K);Y.enableValidation(),Z.enableValidation(),$.enableValidation();var tt=new S({name:".profile__title",activity:".profile__subtitle"}),et=new u({renderer:function(t){var e=X(t.name,t.link,t);return et.addItem(e),e}},Q),nt=new z(".popup_type_confirm-delete-card",(function(t,e){t.preventDefault();var n=ct(t);n.button.value=n.withPunct,ut.deleteCard(e[0]._id).then((function(t){e[1].remove(),e[1]=null,nt.close(),$.blockButton(),n.button.value=n.noPunct}))}));nt.setEventListeners();var rt=new E(".popup_type_image");rt.setEventListeners();var ot=new b(".popup_type_image-form",(function(t,e){t.preventDefault();var n=ct(t);n.button.value=n.withPunct;var r=e["name-img"],o=e.link;ut.postCard(e["name-img"],e.link).then((function(t){return t.json()})).then((function(t){et.addItem(X(r,o,t)),ot.close(),Z.blockButton(),n.button.value=n.noPunct}))}));ot.setEventListeners();var it=new b(".popup_type_redactor-image-form",(function(t,e){t.preventDefault();var n=ct(t);n.button.value=n.withPunct,it.close(),ut.changeAvatar(e.link).then((function(t){A.src=e.link,n.button.value=n.noPunct}))}));function ct(t){var e=t.target.closest(".popup").querySelector(".popup__submit"),n=e.value;return e.value="".concat(e.value,"..."),{button:e,withPunct:e.value,noPunct:n}}it.setEventListeners();var at=new b(".popup_type_text-form",(function(t,e){t.preventDefault();var n=ct(t);n.button.value=n.withPunct,tt.setUserInfo(e),at.close(),ut.patchText(e).then((function(t){U=t._id,n.button.value=n.noPunct}))}));N.addEventListener("click",(function(){var t=tt.getUserInfo();M.value=t.name,G.value=t.activity,at.open()})),at.setEventListeners(),W.addEventListener("click",(function(){return ot.open()}));var ut=new T({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-39",headers:{authorization:"322327ea-4136-41b9-989d-cc6e37a8bd67","Content-Type":"application/json"}},(function(t){var e=t.name,n=t.about,r=t.avatar;A.src=r,U=t._id,tt.setUserInfo({name:e,activity:n})}),(function(t){et.renderItems(t)}),(function(t){console.log(t.likes.length)}));ut.getUserInfo(),ut.renderCards(),F.addEventListener("click",(function(){it.open()}))})();